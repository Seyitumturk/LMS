<body>
    <!-- Sidenav -->
    <% include ../partials/sidebar %>
        <!-- Main content -->
        <div class="main-content">
            <!-- Top navbar -->
            <% include ../partials/navbar %>
                <!-- Header -->
                <% include ../partials/header %>
                    <!-- Page content -->
                    <div class="container-fluid mt--7">
                        <div id="row-fullwidth" class="row">
                            <div class="col-xl-8 mb-5 mb-xl-0">
                                <!-- Chatbox -->
                                <div class="card bg-gradient-white">
                                    <div id="convo-box" class="card-header bg-gradient">
                                        <div class="form-container">
                                            <form id="conversation-form" utocomplete="off" class="conversation-form">
                                                <input type="text" name="text" placeholder="Type your message here...">
                                                <button type="submit" class="generate-btn">Generate</button>
                                            </form>
                                        </div>

                                        <div class="menu-items">

                                            <div class="convoHeader-list-item">

                                                <h2 class="text-uppercase white ls-1 mb-1">Actionize</h2>
                                                <h6 id="selected-template" class="text-black mb-0">
                                                    <span id="selected-product">Weekly</span>
                                                </h6>

                                            </div>
                                            <div class="convoHeader-list-item">
                                                <h2 class="text-uppercase white ls-1 mb-1">Cursor</h2>
                                                <h6 id="selected-template" class="text-black mb-0">
                                                    <span id="selected-product">Explain</span>
                                                </h6>
                                            </div>

                                            <div class="convoHeader-list-item">
                                                <h2 class="text-uppercase light ls-1 mb-1">Cursor</h2>
                                                <h6 id="selected-template" class="text-black mb-0">
                                                    <span id="selected-product">Explain</span>
                                                </h6>
                                            </div>
                                            <div class="convoHeader-list-item">
                                                <h2 class="text-uppercase white ls-1 mb-1">Cursor</h2>
                                                <h6 id="selected-template" class="text-black mb-0">
                                                    <span id="selected-product">Explain</span>
                                                </h6>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- Conversation history -->

                                        <div class="example-section">
                                            <div class="example-prompt">
                                                <div class="prompt-content">
                                                    <div class="prompt-answer">Prompt 1 answer</div>
                                                    <div class="prompt-text">Prompt 1 text</div>
                                                </div>
                                            </div>
                                            <div class="example-prompt">
                                                <div class="prompt-content">
                                                    <div class="prompt-answer">Prompt 2 answer</div>
                                                    <div class="prompt-text">Prompt 2 text</div>
                                                </div>
                                            </div>
                                            <div class="example-prompt">
                                                <div class="prompt-content">
                                                    <div class="prompt-answer">Prompt 3 answer</div>
                                                    <div class="prompt-text">Prompt 3 text</div>
                                                </div>
                                            </div>
                                            <!-- More prompts and answers go here -->
                                        </div>


                                        <!-- Conversation form -->

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Footer -->
                        <% include ../partials/footer %>
                    </div>
        </div>


        <!-- Include scripts -->
        <% include ../partials/scripts %>

            <script>
                const conversationHistory = document.querySelector(".conversation-history");
                const conversationForm = document.querySelector("#conversation-form");

                conversationForm.addEventListener("submit", (event) => {
                    event.preventDefault(); // Prevent default form submission behavior

                    const userMessage = event.target.elements.text.value;
                    event.target.elements.text.value = ""; // Clear input text

                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", "/conversations", true);
                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onload = () => {
                        if (xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText).response;
                            addToConversationHistory(userMessage, response);
                        }
                    };

                    xhr.send(JSON.stringify({
                        text: userMessage,
                    }));
                });

                function addToConversationHistory(userMessage, botMessage) {
                    // Create a new .example-prompt card
                    const examplePrompt = document.createElement("div");
                    examplePrompt.classList.add("example-prompt");

                    // Create the prompt content
                    const promptContent = document.createElement("div");
                    promptContent.classList.add("prompt-content");

                    // Create the prompt answer
                    const promptAnswer = document.createElement("div");
                    promptAnswer.classList.add("prompt-answer");
                    promptAnswer.textContent = botMessage;

                    // Create the prompt text
                    const promptText = document.createElement("div");
                    promptText.classList.add("prompt-text");
                    promptText.textContent = userMessage;

                    // Add the prompt answer and prompt text to the prompt content
                    promptContent.appendChild(promptAnswer);
                    promptContent.appendChild(promptText);

                    // Add the prompt content to the example-prompt card
                    examplePrompt.appendChild(promptContent);

                    // Add the example-prompt card to the example-section div
                    const exampleSection = document.querySelector(".example-section");
                    exampleSection.appendChild(examplePrompt);

                    // Check if the scrollbar is at the bottom before adding new content
                    const isScrolledToBottom = exampleSection.scrollHeight - exampleSection.clientHeight <= exampleSection.scrollTop + 1;

                    // Scroll to the bottom of the example-section div
                    if (isScrolledToBottom) {
                        exampleSection.scrollTop = exampleSection.scrollHeight - exampleSection.clientHeight;
                    }
                }


            </script>
</body>